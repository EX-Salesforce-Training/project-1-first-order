<!-- Page to display all classes a user can add -->

<apex:page showHeader="false" standardStylesheets="false" sidebar="false" applyHtmlTag="false" applyBodyTag="false" docType="html-5.0" 
           standardController="Class__c" recordSetVar="classes" extensions="ClassListExtension" title="Class Listing">
    
    <html>
        <head>
            <meta charset="utf-8" />
            <meta http-equiv="x-ua-compatible" content="ie=edge" />
            <title>Class Listing</title>
            <meta name="viewport" content="width=device-width, initial-scale=1" />
            <apex:slds />
        </head>
        
        <body class="slds-scope">
            
            <div>
                <apex:form >
                    
                    <!-- HEADER -->
                    <!-- have previous and next button to traverse the record list -->
                    <!-- also have the myclass button, display contacts and the class each contact is attending -->
                    <div class="slds-page-header" style="z-index:+1; position:fixed; width:1890px; top:0; margin-right: 40px;">
                        
                        <!-- LAYOUT GRID -->
                        <div class="slds-grid">
                            
                            <!-- HEADING AREA -->
                            <div class="slds-col slds-has-flexi-truncate">
                                <div class="slds-media slds-no-space slds-grow slds-has-flexi-truncate">
                                    <div class="slds-media__figure">
                                        <svg aria-hidden="true" class="slds-icon slds-icon-standard-contact">
                                            <use href="{!URLFOR($Asset.SLDS, 'assets/icons/standard-sprite/svg/symbols.svg#account')}"></use>
                                        </svg>
                                    </div>
                                    <div class="slds-media__body">
                                        <p class="slds-text-title_caps slds-line-height_reset">Aquatic</p>
                                        <h1 class="slds-page-header__title slds-m-right_small slds-align-middle slds-truncate">Class Listing</h1>
                                    </div>
                                </div>
                            </div>
                            <!-- /HEADING AREA -->
                            
                            <!-- VIEW ALL CURRENT CLASS BUTTON -->
                            <div class="slds-col slds-no-flex slds-grid slds-align-top">
                                <div class="slds-button-group" role="group">
                                    <!-- open a popup page to create new contact -->
                                    <apex:commandButton styleClass="slds-button slds-button_neutral" action="{!showAccountInfo}" value="My Class" rerender="AccountInfoPopup"/>
                                </div>
                            </div>
                            <!-- /VIEW ALL CURRENT CLASS BUTTON -->
                            
                        </div>
                        
                        <!-- NEXT&PRV BUTTON -->
                        <div align="center" draggable="false">
                            <apex:commandButton styleClass="slds-button slds-button_neutral" action="{!previous}" value="Previous" reRender="ClassList"/>
                            <span>     </span>
                            <apex:commandButton styleClass="slds-button slds-button_neutral" action="{!next}" value="Next" reRender="ClassList"/>
                        </div> 
                        <!-- /NEXT&PRV BUTTON -->
                        
                        <!-- /LAYOUT GRID -->
                    </div>
                    
                    <!-- /HEADER -->
                    
                    <!-- MAIN CONTENT -->
                    <!-- where the list of class resides -->
                    <apex:pageBlock id="ClassList">
                        <apex:pageBlockSection >
                            <apex:pageBlockSectionItem >
                                <apex:outputPanel >
                                    <apex:pageBlockTable value="{!classListUpdated}" var="c" styleClass="slds-table slds-table_cell-buffer slds-table_bordered slds-p-left_xxx-small"
                                                         style="margin-top: 120px; margin-bottom: 75px;">
                                        <apex:column headerValue="Instructor">
                                            <div class="slds-tile slds-media slds-truncate"> 
                                                <div class="slds-tile slds-media">
                                                    <div class="slds-media__figure">
                                                        <img class="slds-avatar slds-avatar_large" src="{!c.Instructor__r.SmallPhotoUrl}" alt="photo" />
                                                    </div>
                                                    <div class="slds-media__body">
                                                        <ul class="slds-has-dividers_bottom">
                                                            <li class="slds-item"><apex:outputText value="{!c.Instructor__r.Name}"> </apex:outputText></li>
                                                            <li class="slds-item"><apex:outputText value="{!IF(ISNULL(c.Instructor__r.Email), 'None', c.Instructor__r.Email)}"> </apex:outputText></li>
                                                            <li class="slds-item"><apex:outputText value="{!IF(ISNULL(c.Instructor__r.Phone), 'None', c.Instructor__r.Phone)}"> </apex:outputText></li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--maybe some image here -->
                                        </apex:column>
                                        <apex:column headerValue="Adding">
                                            <div class="slds-tile slds-truncate">
                                                <apex:outputField value="{! c.Adding__c}"/>                 
                                            </div>
                                        </apex:column>
                                        <apex:column headerValue="Class Number">
                                            <div class="slds-tile slds-truncate">
                                                <apex:outputText value="{!c.Name}"></apex:outputText>
                                            </div>
                                        </apex:column>
                                        <apex:column headerValue="Class Type">
                                            <div class="slds-tile slds-truncate">
                                                <apex:outputText value="{!c.Class_Type__c}"></apex:outputText>
                                            </div>
                                        </apex:column>
                                        <apex:column headerValue="Class Time">
                                            <div class="slds-tile slds-truncate">
                                                <apex:outputField value="{! c.Class_Time__c}"/>           
                                            </div>
                                        </apex:column>
                                        <apex:column headerValue="Day">
                                            <div class="slds-tile slds-truncate">
                                                <apex:outputText value="{!c.Day__c}"></apex:outputText>
                                            </div>
                                        </apex:column>
                                        <apex:column headerValue="Start Date">
                                            <div class="slds-tile slds-truncate">
                                                <apex:outputText value="{0,date, yyyy/MM/dd, hh:mm}">
                                                    <apex:param value="{!c.Start_Date__c}"/>
                                                </apex:outputText>
                                            </div>
                                        </apex:column>
                                        <apex:column headerValue="Class Price">
                                            <div class="slds-tile slds-truncate">
                                                <apex:outputText value="{!c.Class_Price__c}"></apex:outputText>
                                            </div>
                                        </apex:column>
                                        <apex:column >
                                            <apex:commandButton styleClass="slds-button slds-button_neutral" style="float:right;" value="Add Class" action="{!showConfirm}" rerender="ConfirmationPopup">
                                                <apex:param name="chosenClassID" value="{!c.ID}" assignTo="{!theClass}"/>
                                            </apex:commandButton>
                                        </apex:column>
                                    </apex:pageBlockTable>
                                </apex:outputPanel>
                            </apex:pageBlockSectionItem>
                        </apex:pageBlockSection>
                    </apex:pageBlock>
                    <!-- /MAIN CONTENT -->  
                    <br/>
                    
                    <!-- FOOTER -->
                    <!-- doesn't really do much, just have the next and previous button -->
                    <footer class="slds-card" style="width:1890px; position:fixed; bottom: 0px;">
                        <div class="slds-p-around_large">
                            <div class="slds-grid slds-gutters slds-grid_align-center">
                                <div class="slds-col slds-size_1-of-3">
                                    <span>Some Text</span>
                                </div>
                                <div class="slds-col slds-size_1-of-3">
                                    <div align="center" draggable="false">
                                        <apex:commandButton styleClass="slds-button slds-button_neutral" action="{!previous}" value="Previous" reRender="ClassList" id="prvButton"/>
                                        <span>     </span>
                                        <apex:commandButton styleClass="slds-button slds-button_neutral" action="{!next}" value="Next" reRender="ClassList" id="nxtButton"/>
                                    </div> 
                                </div>
                                <div class="slds-col slds-size_1-of-3">
                                    <span style="float:right;">@Aquatic</span>
                                </div>
                            </div>
                        </div>
                    </footer>
                    <!-- /FOOTER -->
                    
                    <!-- POPUP -->
                    <!-- show the current contacts on the account and what class they are taking. -->
                    <apex:outputPanel id="AccountInfoPopup">
                        <apex:outputPanel styleClass="slds-backdrop slds-backdrop_open" layout="block" rendered="{!accInfoPopup}">
                            <apex:outputPanel layout="block" rendered="{!accInfoPopup}" 
                                              style="position: fixed; z-index: 100; top: 50%; left: 50%; width:700px; height: 800px; 
                                                     margin-left: -350px; margin-top: -400px; background-color: white; border-width: 5px; border-color: black; border-style:solid;">
                                
                                <apex:commandButton action="{!closeAccountInfo}" value="X" rerender="AccountInfoPopup" style="float: right;"/>
                                <apex:pageBlock title="Account Information">
                                    <apex:outputText value="Primary User: {! primaryContact.Name}"></apex:outputText>
                                    <br/><br/>
                                    <apex:outputPanel layout="block" style="overflow:auto; width: 680px; height: 700px; margin-left: 5px;">
                                        <apex:repeat value="{! relatedContacts}" var="cid">
                                            <apex:outputText value="{!cid.Name}"></apex:outputText>
                                            <br/>
                                            <apex:repeat value="{! classAndAttendee[cid.id]}" var="cad">
                                                <ul style="margin-left: 5px;">
                                                    <li><apex:outputText value="   Class Name: {!cad.Class__r.Name}"/></li>
                                                    <li><apex:outputText value="   Class Day: {!cad.Class__r.Day__c}"/></li>
                                                    <li><apex:outputText value="   Class Time: {!cad.Class__r.Class_Time__c}"/></li>
                                                </ul>
                                                
                                                <br/>
                                            </apex:repeat>
                                            <br/>
                                        </apex:repeat>   
                                    </apex:outputPanel>
                                </apex:pageBlock>
                                
                                <!-- </apex:outputPanel> -->
                            </apex:outputPanel>
                        </apex:outputPanel>
                    </apex:outputPanel>
                    
                    
                    
                    
                    <!-- confirmation screen for adding new class to an account -->
                    <apex:outputPanel id="ConfirmationPopup">
                        <apex:outputPanel styleClass="slds-backdrop slds-backdrop_open" layout="block" rendered="{!classAddPopup}">
                            <apex:outputPanel layout="block" rendered="{!classAddPopup}" 
                                              style="position: fixed; z-index: 100; top: 50%; left: 50%; width:600px; height: 300px; 
                                                     margin-left: -300px; margin-top: -150px; background-color: white; border-width: 5px; border-color: black; border-style:solid;">
                                <apex:commandButton action="{!closeConfirm}" value="X" rerender="ConfirmationPopup" style="float: right;"/>
                                <ul class="slds-has-inline-block-links_space">
                                    <br/>  
                                    <li>
                                        <div align="center">
                                            Who will be attending the class?
                                        </div>
                                    </li>
                                    <br/><br/>
                                    <li>  
                                        <div align="center" >
                                            <apex:outputPanel layout="block" style="overflow:auto;width:300px;height: 100px">
                                                <apex:pageBlock >
                                                    <apex:pageBlockTable value="{! contactToAdd }" var="ctd" id="AddTable">
                                                        <apex:column headerValue="Name">
                                                            <apex:outputText value="{!ctd.con.Name}"></apex:outputText>
                                                        </apex:column>
                                                        <apex:column >
                                                            <apex:facet name="header">
                                                                <apex:inputCheckbox id="TopBox" value="{!topBox}" onchange="CallAction(); return false;">
                                                                    <apex:actionSupport event="onclick" action="{!checkOrUncheckAll}" rerender="AddTable"/> 
                                                                </apex:inputCheckBox>
                                                            </apex:facet>
                                                            <apex:inputCheckBox value="{!ctd.selected}"></apex:inputCheckBox>
                                                        </apex:column>
                                                    </apex:pageBlockTable>
                                                    <apex:pageMessages ></apex:pageMessages>
                                                </apex:pageBlock>
                                            </apex:outputPanel>
                                        </div>
                                    </li>
                                    <br/>
                                    <li>
                                        <div align="center">
                                            Click yes will add the class to your account.
                                        </div>
                                    </li>
                                    <br/>
                                    <li>
                                        <div align="center" draggable="false" style="float:bottom;">
                                            <apex:commandButton action="{!closeConfirm}" value="Cancel" rerender="ConfirmationPopup" styleClass="slds-button slds-button_neutral"/>
                                            <span>         </span>
                                            <apex:commandButton action="{!saveList}" value="Save" styleClass="slds-button slds-button_brand"/>
                                        </div>
                                    </li>
                                </ul>
                            </apex:outputPanel>
                        </apex:outputPanel>
                    </apex:outputPanel>
                    <!-- / POPUP -->
                    
                </apex:form>
            </div>
        </body>
    </html>
</apex:page>